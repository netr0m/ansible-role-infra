---
# Environment
infra_env: "{{ lookup('env', 'ENVIRONMENT') | default('production') }}"
# Username of the user owning the files
infra_user_name: 'butler'
# Group name of the group that should own the files
infra_group_name: 'butlers'
# Optionally provide the UID of the user. If absent, the UID will be looked up
infra_user_uid: undefined
# Optionally provide the GID of the group. If absent, the GID will be looked up
infra_group_gid: undefined
# Timezone
infra_tz: Etc/UTC
# Domain name, internal
infra_domain: local
# Domain name, external
infra_domain_ext: example.com
# Password for Pihole web UI
infra_pihole_password:

### Directories ###
# Manage directories
infra_manage_directories: true
# Directory to store service data
infra_directory:
  path: '/opt/infra'
  # Default permissions
  owner: "{{ infra_user_name }}"
  group: "{{ infra_group_name }}"
  mode: 740
# Subdirectories
infra_subdirectories:
  cfg:
    path: "{{ infra_directory.path }}/cfg"
  log:
    path: "{{ infra_directory.path }}/log"
  data:
    path: "{{ infra_directory.path }}/data"

### Services ###
# Default restart policy
infra_restart_policy: 'always'
# Configure PiHole
infra_use_pihole: true
# Configure Unifi Controller
infra_use_unifi: true
# Configure wireguard
infra_use_wireguard: true
# Configure Vaultwarden
infra_use_vaultwarden: true
# Configure Authentik
infra_use_authentik: true

### Unifi ###
# Directories for Unifi
infra_unifi_directories:
  log:
    path: "{{ infra_subdirectories.log.path }}/unifi"
  data:
    path: "{{ infra_subdirectories.data.path }}/unifi"

# Environment variables for the Unifi container
infra_unifi_env_vars:
  PUID: "{{ infra_user_uid }}"
  PGID: "{{ infra_group_gid }}"
  TZ: "{{ infra_tz | default('Etc/UTC') }}"

# Unifi container settings
infra_unifi_container:
  hostname: unifi
  image: linuxserver/unifi-controller:latest
  restart_policy: always
  env_vars: "{{ infra_unifi_env_vars }}"
  ports:
    # tcp
    admin: 8443
    device_comms: 8080
    guest_portal_https: 8843
    # guest_portal_http: 8880
    throughput: 6789
    # udp
    stun: 3478
    discovery: 10001
    l2_discovery: 1900
    syslog: 5514
  memory: 4g

### Pihole ###
# Directories for Pihole
infra_pihole_directories:
  log:
    path: "{{ infra_subdirectories.log.path }}/pihole"
  data:
    path: "{{ infra_subdirectories.data.path }}/pihole"

# Environment variables for the Pihole container
infra_pihole_env_vars:
  PUID: "{{ infra_user_uid }}"
  PGID: "{{ infra_group_gid }}"
  TZ: "{{ infra_tz | default('Etc/UTC') }}"
  WEBPASSWORD: "{{ infra_pihole_password | default(omit) }}"
  VIRTUAL_HOST: "pihole.{{ infra_domain }}"
  DNSMASQ_LISTENING: 'all'

# Extra hosts for Pihole
infra_pihole_extra_hosts: {}
  # service.domain.tld: <IP_ADDR>
  # service1.domain.tld: <IP_ADDR>

# Pihole container settings
infra_pihole_container:
  hostname: pihole
  image: pihole/pihole:latest
  restart_policy: always
  env_vars: "{{ infra_pihole_env_vars }}"
  ports:
    ui: 8053
    dns: 53
  memory: 4g

### Wireguard ###
# Directories for Wireguard
infra_wireguard_directories:
  log:
    path: "{{ infra_subdirectories.log.path }}/wireguard"
  cfg:
    path: "{{ infra_subdirectories.cfg.path }}/wireguard"

# Environment variables for the Wireguard container. See https://github.com/linuxserver/docker-wireguard#parameters
infra_wireguard_env_vars:
  PUID: "{{ infra_user_uid }}"
  PGID: "{{ infra_group_gid }}"
  TZ: "{{ infra_tz | default('Etc/UTC') }}"
  SERVERURL: "{{ infra_wireguard_container.hostname }}.{{ infra_domain_ext | default(infra_domain) }}"
  SERVERPORT: "{{ infra_wireguard_container.ports.vpn }}"
  PEERS: "{{ infra_wireguard_peers | join(',') }}"
  PEERDNS: auto
  PERSISTENTKEEPALIVE_PEERS: all
  INTERNAL_SUBNET: '10.13.13.0'
  ALLOWEDIPS: '0.0.0.0/0, ::0/0'
  LOG_CONFS: 'false'

# Peers to create. See https://github.com/linuxserver/docker-wireguard#parameters
infra_wireguard_peers: []
  # - laptop
  # - desktop
  # - phone

# Wireguard container settings
infra_wireguard_container:
  hostname: wg
  image: linuxserver/wireguard:latest
  restart_policy: always
  ports:
    # udp
    vpn: 51820
  memory: 1g

### Vaultwarden ###
# Directories for Vaultwarden
infra_vaultwarden_directories:
  log:
    path: "{{ infra_subdirectories.log.path }}/vaultwarden"
  data:
    path: "{{ infra_subdirectories.data.path }}/vaultwarden"

# Environment variables for the Vaultwarden container
infra_vaultwarden_env_vars:
  WEBSOCKET_ENABLED: 'true'
  DOMAIN: "https://{{ infra_vaultwarden_container.hostname }}.{{ svc_domain }}"
  EXTENDED_LOGGING: 'true'
  LOG_FILE: /data/logs/vaultwarden.log
  LOG_LEVEL: WARN
  SIGNUPS_ALLOWED: 'false'
  SIGNUPS_DOMAINS_WHITELIST: ''
  INVITATIONS_ALLOWED: 'false'
  DISABLE_ADMIN_TOKEN: 'false'
  PASSWORD_ITERATIONS: '350000'
  PASSWORD_HINTS_ALLOWED: 'false'
  SHOW_PASSWORD_HINT: 'false'


# Vaultwarden container settings
infra_vaultwarden_container:
  hostname: vault
  image: vaultwarden/server:1.27.0
  restart_policy: always
  memory: 2g

### Authentik ###
# Directories for Authentik
infra_authentik_directories:
  log:
    path: "{{ infra_subdirectories.log.path }}/authentik"
  data:
    path: "{{ infra_subdirectories.data.path }}/authentik"

# Secret key used for Authentik cookie signing
infra_authentik_secret_key: ""
# Database user
infra_authentik_db_user: "authentik"
# Database password
infra_authentik_db_password: ""
# Database name
infra_authentik_db_name: "authentik"

# Environment variables for the Authentik config
infra_authentik_env_vars_authentik:
  AUTHENTIK_COOKIE_DOMAIN: "{{ svc_domain }}"
  AUTHENTIK_LOG_LEVEL: 'INFO'
  AUTHENTIK_GEOIP: /geoip/GeoLite2-City.mmdb
  AUTHENTIK_DISABLE_UPDATE_CHECK: 'false'
  AUTHENTIK_ERROR_REPORTING__ENABLED: 'false'
  AUTHENTIK_ERROR_REPORTING__SENTRY_DSN: ""
  AUTHENTIK_ERROR_REPORTING__ENVIRONMENT: customer
  AUTHENTIK_ERROR_REPORTING__SEND_PII: 'false'
  AUTHENTIK_AVATARS: initials
  AUTHENTIK_DEFAULT_USER_CHANGE_NAME: 'true'
  AUTHENTIK_DEFAULT_USER_CHANGE_EMAIL: 'false'
  AUTHENTIK_DEFAULT_USER_CHANGE_USERNAME: 'false'
  AUTHENTIK_GDPR_COMPLIANCE: 'true'
  AUTHENTIK_DEFAULT_TOKEN_LENGTH: '60'
  AUTHENTIK_IMPERSONATION: 'false'
  AUTHENTIK_EMAIL__HOST: 'localhost'
  AUTHENTIK_EMAIL__PORT: '25'
  AUTHENTIK_EMAIL__USERNAME: ""
  AUTHENTIK_EMAIL__PASSWORD: ""
  AUTHENTIK_EMAIL__USE_TLS: 'false'
  AUTHENTIK_EMAIL__USE_SSL: 'false'
  AUTHENTIK_EMAIL__TIMEOUT: '10'
  AUTHENTIK_EMAIL__FROM: "authentik@{{ svc_domain }}"

# Authentik container hostname
infra_authentik_container_hostname: authentik
# Authentik container image
infra_authentik_container_image: ghcr.io/goauthentik/server:2023.5.3
# Authentik container restart policy
infra_authentik_container_restart_policy: always
# Authentik server container memory
infra_authentik_container_memory_server: 2g
# Authentik worker container memory
infra_authentik_container_memory_worker: 2g
# Authentik Redis container image
infra_authentik_container_redis_image: docker.io/library/redis:alpine
# Authentik redis container memory
infra_authentik_container_memory_redis: 2g
# Authentik postgres container image
infra_authentik_container_postgresql_image: docker.io/library/postgres:12-alpine
# Authentik postgres container memory
infra_authentik_container_memory_postgresql: 1g
...
